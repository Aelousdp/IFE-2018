# 正式任务

## 最终需求描述

- 这是一个数据报表定制页面，有许多筛选表单，有一个表格，以及几个图表，需要我们在不使用任何框架的情况下，完成这个页面的开发
- 页面初始化的时候，显示默认的数据及图表
- 根据用户的表单选择，可以进行数据和图表的切换，但这些切换动作都是在当前页面中完成
- 用户可以在当前页面上做一些数据修改，我们先设定这些修改仅对自己有效，将数据存在浏览器本地
- 当用户选择了某种数据视图（选择了某些选项所展示的数据及图表）后，可以复制当前URL给其他人，其他人也能看见同样的视图，而不是回到初始化效果

# 任务拆解

## 流程图 + 模块关系图，整个任务可以分为几个模块

- 路由模块：负责指挥页面的其他部分，该以什么样的状态来呈现页面 
- 表单模块：负责承接用户的交互以及高速后面的模块如何组装数据，展示图表
- 数据处理模块：根据用户的输入，对数据进行组合，提供给页面展现
- 表格模块：负责用表格的形式展现数据
- 图表模块：负责用图表的形式展现数据

# 从简单的开始

## 需求

- 表单：我们先从最简单的表单开始，我们的数据维度有：月、地区、商品种类，表单选项的任务就是做这几个维度的筛选或者组合的设置。我们先只做一个，用来做示例，比如我们选择地区，使用一个Select或者单选，让用户可以选择地区。选项应该包括华东、华南、华北三个地区。
- 数据处理：接下来，我们根据用户选择的地区表单，从完整数据中，把对应选择地区的数据取出来。
- 表格：最后，将上一步取出来的数据渲染成表格，表格有一个表头，用于显示数据标题：商品、地区、1月、2月......12月，然后共有14列：商品、地区以及12个月的销售情况

# 稍微复杂一些

## 需求

- 现在加入第二个表单，商品种类，依然是select或者radio，自选
- 两个表单项都存在，做并集的选择，比如选择了华北，和手机，表示要看华北地区的手机销售情况
- 两个表单的选项互相不干扰，即**改变其中一个的时候，不会导致另外一个的选项发生变化**

## 设计

> 很明显，这里要调整的是“根据select选项获取数据()”这个方法

``` javascript
function 根据select选项获取数据() {
    遍历数据 {
        向要返回的数据list中添加符合两个表单项所选的数据
    }
    返回数据
}
```

# 再复杂一些

## 需求

- 有时候我们不仅仅要看某一地区的数据，我们可能会想看好几个地区的数据，或者我们想看某个地区所有商品的销售情况，我们需要将地区及商品从单选改为多选
- 同时为了方便多选，我们设定一个功能叫做全部选择，分别给地区和商品添加一个全选的CheckBox，全选有如下状态和逻辑：
    - 点击全选是，如果单个选项中只要有一个不是被选上的状态，则进行全选操作
    - 点击全选时，如果单个选项中所有选项都已经是被选上的状态，则无反应
    - 点击最后一个未被选中的单个选项后，全选CheckBox也要置为被勾选状态
    - 如果当前是全选状态，取消任何一个子选项，则全选CheckBox也要置为未勾选状态
    - 不允许一个都不勾选，所以当用户想取消唯一一个被勾选的子选项时，无交互反应，不允许取消勾选

## 设计

首先整理代码逻辑，将select换成CheckBox。<br>
我们有两组CheckBox，从全选的逻辑是一致的，只是文案和具体值不一样，所以在这里我们要尽可能的想办法让两组CheckBox的逻辑能复用，而不用写两遍。<br>
我们先来看看只有一组的情况下，逻辑是如何的：

- 分别给全选的CheckBox和各个单选的CheckBox绑定点击事件
- 对于全选的CheckBox的点击事件，要做的事情很简单，让所有的CheckBox全部勾选上
- 对于单个的CheckBox，每次点击要做如下判断：
    - 在点击之前它是不是唯一一个被勾选的？如果是的话，阻止这次点击默认操作，或者立马又将其checked状态置为真
    - 点击之后，是不是满足了全选状态，并对应修改全选CheckBox的状态